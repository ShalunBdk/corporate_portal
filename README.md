# Корпоративный портал

## Функциональные возможности:

### Просмотр структуры организации:

- Делается выгрузка из Active Directory сотрудников и их руководителях, на основе этих данных строится дерево иерархии.
- Можно добавлять отделы и выбирать руководителя отдела от которого будет строиться иерархическое дерево.

### Новости компании:

- Обычные и не авторизованные пользователи  могут просматривать новости на главное странице и отдельном разделе.
- Администраторы и те у кого есть соответствующие права могут новости выкладывать и редактировать. 

### Календарь с планированием отпусков:

- Авторизованный сотрудник или его руководитель может зайти в календарь и запланировать отпуск. Сотрудники смогут просматривать отпуска своих коллег в отделе.
- На этом же календаре можно будет отметить больничный или уход на удалёнку.

### Профили пользователей:

- Авторизованный сотрудники смогут смотреть профили коллег для того, что бы уточнить отдел/руководителя/номер телефона, а так же статус сотрудника(отпуск/больничный/удалёнка)

### Раздел с документацией, инструкциями и стандартами:

- Администраторы сайта смогут загружать файлы, которые пользователи смогут просмотреть и при необходимости скачать.

### Раздел дней рождений сотрудников:

- Возможности просмотра дней рождений сотрудников по месяцам и локациям работы. 

## Стек технологий:

### FastAPI:

- Реализация API для новостей, пользователей, событий календарей.
- Эндпоинты для создания, редактирования, получения и удаления новостей.
- Эндпоинты для получения структуры организации и информации о сотрудниках.
- Эндпоинты для создания, редактирования, получения и удаления событий календарей.

### SQLAlchemy:

- ORM для работы с базой данных, в которой хранятся:
- Пользователи выгружаемые из Active Directory.
- Логи действий пользователей  и администраторов.
- Новости создаваемые на сайте.
- События календарей создаваемых пользователями.

### Redis:

- **Кэширование данных о структуре и самих пользователях**:
- Хранение структуры организации в Redis для ускорения подгрузки её на сайте.
- Кэширование данных пользователей, чтобы сократить количество запросов к базе данных при просмотре страниц.
- **Хранение сессий**: Кэширование информации о сессиях пользователей для быстрой авторизации.
- Использование TTL (время жизни) для кэша, чтобы он обновлялся автоматически.

### Celery:

- **Фоновые задачи**:
- Подгрузка изменений из Active Directory
- Генерация PDF-файлов о отпусках в отделе.
- Планирование задач для очистки устаревшего кэша в Redis.

### Работа с файлами:

- Возможность загрузки файлов (картинки для новостей).
- Администратор и авторы могут загружать файлы с документацией или инструкциями для дальнейшего чтения пользователями (например, PDF).

### PostgreSQL:

- **Хранение пользователей**: В базе данных хранятся пользователи получаемые из Active Directory.
- **Хранение логов действий пользователей и администраторов**: Система сохраняет информацию о каждом действии изменяющих данные.
- **Хранение новостей**: Текст, картинка, автор и дата создания.
- **События в календарях:** отпуска, больничные и уходы на удалёнку.
- **Хранения названий отделов и организации**: с возможностью редактирования при изменении структуры компании


## Возможности проекта:

### Реализация поиска и фильтрации сотрудников:
- Быстрый поиск сотрудников с использованием кэшированных данных из Redis.
- Фильтрация сотрудников по должности/отделу/организации.
### Календарь отпусков:
- сотрудники смогут заполнить предпочтительные даты для отпуска, а руководитель отдела отредактировать их
### Просмотр статуса сотрудника:
- в зависимости от событий в календаре(отпуск, больничный, удалёнка) общедоступный статус сотрудника меняется.
### Просмотр структуры организации:
- для удобного поиска нужного сотрудника



## Дополнительные функции:

- **Возможность просмотра предстоящих дней рождений**
- **Новости компании**
- **Просмотр информации о сотрудниках**
- **Хранение файлов с инструкция, документацией и стандартами компании**






## Структура БД

[Ссылка](https://www.drawdb.app/editor?shareId=689fc89c0cf418905b5fa17d3e9e9f81)

## API ручки

### Users

```
GET /users  # Получение всех пользователей
GET /users/update   # Принудительный запуск синхронизации с Active Directory
GET /users?id=111  # Получение пользователя по id
GET /users/111/status   # Получить статус сотрудника Работает/Болеет/Отпуск/Удалёнка/Уволен  (возможно проще отдавать статус в обычном запросе по id)
GET /users/me   # Получение пользователя который выполняет запрос
GET /users/hierarchy   # Получения пользователей в формате нужном для иерархии
GET /users/birthdays?days=30   # Получение сотрудников у которых день рождения день рождения близжайшие N дней
```

### Organizations

```
GET /orgs   # Получение всех организаций
POST /orgs   # Добавление организации
DELETE /orgs?id=111   # Удаление организации
GET /orgs?id=111&name=ХК   # Получение организации по id
PUT /orgs?id=111   # Редактрование организации
```

### Departments

```
GET /deps   # Получение всех отделов
GET /deps?org_id=1   # Получение отделов организации
GET /deps?id=22   # Получение отдела по id
POST /deps?org_id=1   # Добавление отдела в организацию
DELETE /deps?id=111   # Удаление отдела
```

### News

```
GET /news   # Получение всех новостей
GET /news?id=22   # Получение новости по id
POST /news   # Добавление новости
DELETE /news?id=22   # Удаление новости
PATCH /news?id=22   # Частичное редактирвоание новости
PUT /news?id=22   # Редактирование новости
```

### Events

```
GET /events   # Получение всех событий календарей
					(Обязателньый атрибуты date_from и date_to)
					
GET|POST /events/vacations   # Получение|Добавление отпусков сотрудников

GET|POST  /events/remote   # Получение|Добавление событий когда сотрудники были на удалёнке

GET|POST  /events/sick   # Получение|Добавление событий когда сотрудники болели

DELETE|PATCH /events/vacations?id=11 Удаление|Редактирование отпусков сотрудников

DELETE|PATCH /events/remote?id=11 Удаление|Редактирование отпусков сотрудников

DELETE|PATCH /events/sick?id=11 Удаление|Редактирование отпусков сотрудников

```

### Documents

```
GET /docs   # Получить файлы(инструкции, документация и стандарты)
POST /docs   # Загрузить файл
DELETE /docs?id=1   # Удалить файл
```
